
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
            
<html>

<meta content="text/html; charset=UTF-8" http-equiv="content-type">
            
<head>
<title>Пользовательские дополнения - Lua API - FunctionFormGetWidgetCoreTree</title>
<link href="LuaApi.css" rel="stylesheet" type="text/css">
</head>
<body>
<h1>Пользовательские дополнения</h1>
<p><a href="../Index.html">На главную</a></p>
<hr>
<p>## page was renamed from FunctionFormGeWidgetCoreTree</p>
<p></p>
<h2> GetWidgetCoreTree( self, indexFunction, tWidgetByInstanceId )</h2>
<p></p>
<p>'''Внимание! Функция создана для оптимизации widgetcore и едва-ли применима где-либо еще'''</p>
<p></p>
<p>Возвращает дерево виджетов в формате TWidget начиная с self.</p>
<p></p>
<p>В TWidgetByInstanceId должно быть передано</p>
<ul><li><p> Пустая таблица - будет заполнена как hash_map&lt; instanceId, TWidget &gt;</p></li></ul>
<ul><li><p> Валидный hash_map&lt; instanceId, TWidget &gt; - будет обновлен. Важно! повторный обход поддеревьев известных виджетов не выполняется</p></li></ul>
<p></p>
<pre>
-- класс
Метод определен у WidgetForm, но может принимать произвольный WidgetSafe в self

-- Семантика
function GetWidgetCoreTree( self, indexFunction, TWidgetByInstanceId )

-- входные параметры
self - WidgetSafe - корень построения дерева виджетов
indexFunction - function - функция __index для метатаблиц виджетов (смотри скриптовый класс widgetcore)
TWidgetByInstanceId - table - hash_map&lt; instanceId, TWidget &gt;, передается по ссылке (!) и изменяется (!).

-- возвращаемое значение
table - TWidget - дерево виджетов в формате TWidget
Структура tWidget:
{
  wtChildName01 = TWidget01,
  wtChildName02 = TWidget02,
  ...
  wtChildNameN = TWidgetN
} with META: {
  __index = indexFunction
  widget - WidgetSafe (userdata) - реальный виджет
  id - instanceId(light userdata) - ид виджета
}
Все данные по ссылкам, таблицы нигде не копируются, одному виджету соответствует ровно одна таблица в дереве и ровно одна ссылка на нее в TWidgetByInstanceId

-- пример
--------------------------------------------------------------------------------
local WIDGET_NAME_PREFIX = "wt" -- Не менять!
--------------------------------------------------------------------------------
local tWidgetByInstanceId = {}
local _widgetcore = {}
local _cppwrap = function()
	---BEGIN_DEBUG---
	error( "widgetcore::__cppwrap: FATAL: Init failed, mainForm not exist" )
	---END_DEBUG---
end
--------------------------------------------------------------------------------
-- Internal
local function _index( obj, key )
	local widget = getmetatable( obj ).widget
	if key == "widget" then
		return widget
	end

	local method = _widgetcore[ key ]

	if not method and type( widget[ key ] ) == "function" then
		method = function( self, ... )
			local widget = self:GetRaw()
			return widget[ key ]( widget, ... )
		end

		_widgetcore[ key ] = method
	end

	return method
end
--------------------------------------------------------------------------------
-- Internal
local function wrap( widget )
	---BEGIN_DEBUG---
	assert( IsTWidget( widget ) or common.IsWidget( widget ), "widgetcore::wrap FATAL: Widget expected, got %s", apitype( widget ) )
	assert( widget:GetAddonName() == ADDON_NAME, "widgetcore::wrap FATAL: Foreign widget wrapping is prohibited" )
	---END_DEBUG---
	return tWidgetByInstanceId[ widget:GetInstanceId() ] or _cppwrap( widget, _index, tWidgetByInstanceId )
end
--------------------------------------------------------------------------------
-- Превратить обычный виджет в TWidget
function TWidget( widget )
	return wrap( widget )
end
--------------------------------------------------------------------------------
-- Получить TWidget по обычному виджету
function GetTWidget( widget )
	return tWidgetByInstanceId[ widget:GetInstanceId() ]
end
--------------------------------------------------------------------------------
-- Получить TWidget по instanceId
function GetTWidgetById( instanceId )
	return instanceId and tWidgetByInstanceId[ instanceId ]
end
--------------------------------------------------------------------------------
-- Проверить что аргумент это TWidget
function IsTWidget( widget )
	local id = widget and type( widget ) == "table" and widget.GetInstanceId and widget:GetInstanceId() or false
	return id and tWidgetByInstanceId[ id ] ~= nil
end
--------------------------------------------------------------------------------
if rawget( _G, "mainForm" ) then
	_cppwrap = mainForm.GetWidgetCoreTree
	mainForm = _cppwrap( mainForm, _index, tWidgetByInstanceId )
end
--------------------------------------------------------------------------------
</pre>
<p></p>
<h4>Связанные страницы: "CategoryLuaApi" "CategoryForm"</h4>
<p></p>
<a href="CategoryForm.html">CategoryForm</a>
<br><a href="FunctionFormCreateWidgetByDesc.html">FunctionFormCreateWidgetByDesc</a>
<br><a href="FunctionFormGetWidgetCoreTree.html">FunctionFormGetWidgetCoreTree</a>
<br><a href="WidgetForm.html">WidgetForm</a>
<p></p>
<h4>Связанные страницы: "CategoryLuaApi" "CategoryWidget"</h4>
<p></p>
<a href="CategoryButton.html">CategoryButton</a>
<br><a href="CategoryControl3D.html">CategoryControl3D</a>
<br><a href="CategoryDiscreteSlider.html">CategoryDiscreteSlider</a>
<br><a href="CategoryEditBase.html">CategoryEditBase</a>
<br><a href="CategoryEditBox.html">CategoryEditBox</a>
<br><a href="CategoryEditLine.html">CategoryEditLine</a>
<br><a href="CategoryForm.html">CategoryForm</a>
<br><a href="CategoryPanel.html">CategoryPanel</a>
<br><a href="CategoryScrollableContainer.html">CategoryScrollableContainer</a>
<br><a href="CategoryTextContainer.html">CategoryTextContainer</a>
<br><a href="CategoryTextView.html">CategoryTextView</a>
<br><a href="CategoryWidget.html">CategoryWidget</a>
<br><a href="CategoryWidgetEffects.html">CategoryWidgetEffects</a>
<br><a href="EnumAFCT.html">EnumAFCT</a>
<br><a href="EnumAlignX.html">EnumAlignX</a>
<br><a href="EnumAlignY.html">EnumAlignY</a>
<br><a href="EnumColorType.html">EnumColorType</a>
<br><a href="EnumKeyboardFlags.html">EnumKeyboardFlags</a>
<br><a href="EnumMouseButton.html">EnumMouseButton</a>
<br><a href="EventEffectFinished.html">EventEffectFinished</a>
<br><a href="EventEffectSequenceFinished.html">EventEffectSequenceFinished</a>
<br><a href="EventEffectSequenceStep.html">EventEffectSequenceStep</a>
<br><a href="EventUpdateShrinkRatio.html">EventUpdateShrinkRatio</a>
<br><a href="EventValuedObjectClicked.html">EventValuedObjectClicked</a>
<br><a href="EventValuedObjectDoubleClicked.html">EventValuedObjectDoubleClicked</a>
<br><a href="EventValuedObjectMouseOver.html">EventValuedObjectMouseOver</a>
<br><a href="EventWidgetShowChanged.html">EventWidgetShowChanged</a>
<br><a href="FunctionFormCreateWidgetByDesc.html">FunctionFormCreateWidgetByDesc</a>
<br><a href="FunctionFormGetWidgetCoreTree.html">FunctionFormGetWidgetCoreTree</a>
<br><a href="FunctionTextContainerInsertText.html">FunctionTextContainerInsertText</a>
<br><a href="FunctionTextContainerPushBackRawText.html">FunctionTextContainerPushBackRawText</a>
<br><a href="FunctionTextContainerPushBackText.html">FunctionTextContainerPushBackText</a>
<br><a href="FunctionTextContainerPushBackValuedText.html">FunctionTextContainerPushBackValuedText</a>
<br><a href="FunctionTextContainerPushFrontRawText.html">FunctionTextContainerPushFrontRawText</a>
<br><a href="FunctionTextContainerPushFrontText.html">FunctionTextContainerPushFrontText</a>
<br><a href="FunctionTextContainerPushFrontValuedText.html">FunctionTextContainerPushFrontValuedText</a>
<br><a href="FunctionTextViewFinishTextScaleEffect.html">FunctionTextViewFinishTextScaleEffect</a>
<br><a href="FunctionTextViewPlayTextScaleEffect.html">FunctionTextViewPlayTextScaleEffect</a>
<br><a href="FunctionTextViewPlayTextScaleEffectSequence.html">FunctionTextViewPlayTextScaleEffectSequence</a>
<br><a href="FunctionWidgetAddChild.html">FunctionWidgetAddChild</a>
<br><a href="FunctionWidgetCreateChildByDesc.html">FunctionWidgetCreateChildByDesc</a>
<br><a href="FunctionWidgetDestroyWidget.html">FunctionWidgetDestroyWidget</a>
<br><a href="FunctionWidgetEnable.html">FunctionWidgetEnable</a>
<br><a href="FunctionWidgetFinishAllEffects.html">FunctionWidgetFinishAllEffects</a>
<br><a href="FunctionWidgetFinishFadeEffect.html">FunctionWidgetFinishFadeEffect</a>
<br><a href="FunctionWidgetFinishMoveEffect.html">FunctionWidgetFinishMoveEffect</a>
<br><a href="FunctionWidgetFinishResizeEffect.html">FunctionWidgetFinishResizeEffect</a>
<br><a href="FunctionWidgetFinishRotationEffect.html">FunctionWidgetFinishRotationEffect</a>
<br><a href="FunctionWidgetGetActiveChildrenRects.html">FunctionWidgetGetActiveChildrenRects</a>
<br><a href="FunctionWidgetGetAddonName.html">FunctionWidgetGetAddonName</a>
<br><a href="FunctionWidgetGetAddonType.html">FunctionWidgetGetAddonType</a>
<br><a href="FunctionWidgetGetBackgroundColor.html">FunctionWidgetGetBackgroundColor</a>
<br><a href="FunctionWidgetGetBackgroundTexture.html">FunctionWidgetGetBackgroundTexture</a>
<br><a href="FunctionWidgetGetChildChecked.html">FunctionWidgetGetChildChecked</a>
<br><a href="FunctionWidgetGetChildUnchecked.html">FunctionWidgetGetChildUnchecked</a>
<br><a href="FunctionWidgetGetFade.html">FunctionWidgetGetFade</a>
<br><a href="FunctionWidgetGetForegroundColor.html">FunctionWidgetGetForegroundColor</a>
<br><a href="FunctionWidgetGetForegroundTexture.html">FunctionWidgetGetForegroundTexture</a>
<br><a href="FunctionWidgetGetName.html">FunctionWidgetGetName</a>
<br><a href="FunctionWidgetGetNamedChildren.html">FunctionWidgetGetNamedChildren</a>
<br><a href="FunctionWidgetGetParent.html">FunctionWidgetGetParent</a>
<br><a href="FunctionWidgetGetPickChildrenOnly.html">FunctionWidgetGetPickChildrenOnly</a>
<br><a href="FunctionWidgetGetPlacementPlain.html">FunctionWidgetGetPlacementPlain</a>
<br><a href="FunctionWidgetGetPriority.html">FunctionWidgetGetPriority</a>
<br><a href="FunctionWidgetGetRealRect.html">FunctionWidgetGetRealRect</a>
<br><a href="FunctionWidgetGetRotation.html">FunctionWidgetGetRotation</a>
<br><a href="FunctionWidgetGetSmartPlacementPlain.html">FunctionWidgetGetSmartPlacementPlain</a>
<br><a href="FunctionWidgetGetTabOrder.html">FunctionWidgetGetTabOrder</a>
<br><a href="FunctionWidgetGetTransparentInput.html">FunctionWidgetGetTransparentInput</a>
<br><a href="FunctionWidgetGetWidgetDesc.html">FunctionWidgetGetWidgetDesc</a>
<br><a href="FunctionWidgetHasActiveEffects.html">FunctionWidgetHasActiveEffects</a>
<br><a href="FunctionWidgetHasBackground.html">FunctionWidgetHasBackground</a>
<br><a href="FunctionWidgetHasForeground.html">FunctionWidgetHasForeground</a>
<br><a href="FunctionWidgetIsClipContent.html">FunctionWidgetIsClipContent</a>
<br><a href="FunctionWidgetIsEnabled.html">FunctionWidgetIsEnabled</a>
<br><a href="FunctionWidgetIsEnabledEx.html">FunctionWidgetIsEnabledEx</a>
<br><a href="FunctionWidgetIsFocused.html">FunctionWidgetIsFocused</a>
<br><a href="FunctionWidgetIsValid.html">FunctionWidgetIsValid</a>
<br><a href="FunctionWidgetIsVisible.html">FunctionWidgetIsVisible</a>
<br><a href="FunctionWidgetIsVisibleEx.html">FunctionWidgetIsVisibleEx</a>
<br><a href="FunctionWidgetPlayBackground.html">FunctionWidgetPlayBackground</a>
<br><a href="FunctionWidgetPlayEffectSequencePack.html">FunctionWidgetPlayEffectSequencePack</a>
<br><a href="FunctionWidgetPlayFadeEffect.html">FunctionWidgetPlayFadeEffect</a>
<br><a href="FunctionWidgetPlayFadeEffectSequence.html">FunctionWidgetPlayFadeEffectSequence</a>
<br><a href="FunctionWidgetPlayMoveEffect.html">FunctionWidgetPlayMoveEffect</a>
<br><a href="FunctionWidgetPlayMoveEffectSequence.html">FunctionWidgetPlayMoveEffectSequence</a>
<br><a href="FunctionWidgetPlayResizeEffect.html">FunctionWidgetPlayResizeEffect</a>
<br><a href="FunctionWidgetPlayResizeEffectSequence.html">FunctionWidgetPlayResizeEffectSequence</a>
<br><a href="FunctionWidgetPlayRotationEffect.html">FunctionWidgetPlayRotationEffect</a>
<br><a href="FunctionWidgetPlayRotationEffectSequence.html">FunctionWidgetPlayRotationEffectSequence</a>
<br><a href="FunctionWidgetPlayRotationWithChildrenEffect.html">FunctionWidgetPlayRotationWithChildrenEffect</a>
<br><a href="FunctionWidgetPlayRotationWithChildrenEffectSequence.html">FunctionWidgetPlayRotationWithChildrenEffectSequence</a>
<br><a href="FunctionWidgetRotate.html">FunctionWidgetRotate</a>
<br><a href="FunctionWidgetRotateWithChildren.html">FunctionWidgetRotateWithChildren</a>
<br><a href="FunctionWidgetSetBackgroundBlendEffect.html">FunctionWidgetSetBackgroundBlendEffect</a>
<br><a href="FunctionWidgetSetBackgroundClearMaskEffect.html">FunctionWidgetSetBackgroundClearMaskEffect</a>
<br><a href="FunctionWidgetSetBackgroundColor.html">FunctionWidgetSetBackgroundColor</a>
<br><a href="FunctionWidgetSetBackgroundTexture.html">FunctionWidgetSetBackgroundTexture</a>
<br><a href="FunctionWidgetSetClipContent.html">FunctionWidgetSetClipContent</a>
<br><a href="FunctionWidgetSetFade.html">FunctionWidgetSetFade</a>
<br><a href="FunctionWidgetSetFocus.html">FunctionWidgetSetFocus</a>
<br><a href="FunctionWidgetSetForegroundBlendEffect.html">FunctionWidgetSetForegroundBlendEffect</a>
<br><a href="FunctionWidgetSetForegroundClearMaskEffect.html">FunctionWidgetSetForegroundClearMaskEffect</a>
<br><a href="FunctionWidgetSetForegroundColor.html">FunctionWidgetSetForegroundColor</a>
<br><a href="FunctionWidgetSetForegroundTexture.html">FunctionWidgetSetForegroundTexture</a>
<br><a href="FunctionWidgetSetName.html">FunctionWidgetSetName</a>
<br><a href="FunctionWidgetSetOnShowNotification.html">FunctionWidgetSetOnShowNotification</a>
<br><a href="FunctionWidgetSetPickChildrenOnly.html">FunctionWidgetSetPickChildrenOnly</a>
<br><a href="FunctionWidgetSetPlacementPlain.html">FunctionWidgetSetPlacementPlain</a>
<br><a href="FunctionWidgetSetPriority.html">FunctionWidgetSetPriority</a>
<br><a href="FunctionWidgetSetSmartPlacementPlain.html">FunctionWidgetSetSmartPlacementPlain</a>
<br><a href="FunctionWidgetSetTabOrder.html">FunctionWidgetSetTabOrder</a>
<br><a href="FunctionWidgetSetTransparentInput.html">FunctionWidgetSetTransparentInput</a>
<br><a href="FunctionWidgetShow.html">FunctionWidgetShow</a>
<br><a href="TypeWidgetDesc.html">TypeWidgetDesc</a>
<br><a href="Widget.html">Widget</a>
<br><a href="WidgetControlDescription.html">WidgetControlDescription</a>
<br><a href="WidgetsEffectsAlgorithms.html">WidgetsEffectsAlgorithms</a>
<br><a href="WidgetsEffectsFinishEffectTemplate.html">WidgetsEffectsFinishEffectTemplate</a>
<br><a href="WidgetsEffectsPlayEffectSequenceTemplate.html">WidgetsEffectsPlayEffectSequenceTemplate</a>
<br><a href="WidgetsEffectsPlayEffectTemplate.html">WidgetsEffectsPlayEffectTemplate</a>
<br><a href="WidgetsEffectsTypes.html">WidgetsEffectsTypes</a>
<p></p>
<p></p>
<hr>
<a href="CategoryLuaApi.html">CategoryLuaApi</a>
<a href="CategoryFunction.html">CategoryFunction</a>
<a href="CategoryForm.html">CategoryForm</a>
<a href="CategoryWidget.html">CategoryWidget</a>
<hr>
<p><a href="../Index.html">На главную</a></p>
</body>
</html>
